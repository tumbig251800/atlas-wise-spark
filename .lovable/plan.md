

## ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏¢‡∏±‡∏á‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö teacher_id ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô

‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô‡πÄ‡∏ü‡∏™ 5 ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö **‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÉ‡∏´‡∏°‡πà** ‡πÅ‡∏ï‡πà **‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤** ‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏°‡∏µ `teacher_id` ‡πÄ‡∏õ‡πá‡∏ô ID ‡∏Ç‡∏≠‡∏á‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ Dashboard ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡πÅ‡∏ó‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏à‡∏£‡∏¥‡∏á

### ‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô" ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ History

‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß re-import ‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÉ‡∏´‡πâ Director ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ **‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô teacher_id ‡∏Ç‡∏≠‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß** ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á

### ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ

| ‡πÑ‡∏ü‡∏•‡πå | ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á |
|------|----------------|
| `src/pages/History.tsx` | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏£‡∏π" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Director + dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏£‡∏π + ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï teacher_id, teacher_name ‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á teaching_logs ‡πÅ‡∏•‡∏∞ diagnostic_events, remedial_tracking, strike_counter, pivot_events ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á |

### ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ

1. **‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏° "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏£‡∏π"** (‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô UserCog) ‡∏Ç‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö ‚Äî ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Director
2. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î Dialog ‡∏ó‡∏µ‡πà‡∏°‡∏µ dropdown ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏£‡∏π (‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å profiles + user_roles ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô UploadCSV)
3. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô ‚Üí ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï:
   - `teaching_logs.teacher_id` ‡πÅ‡∏•‡∏∞ `teaching_logs.teacher_name`
   - `diagnostic_events.teacher_id` (where teaching_log_id = log.id)
   - `remedial_tracking.teacher_id` (where teaching_log_id = log.id)
   - `strike_counter.teacher_id` (where last_session_id = log.id)
   - `pivot_events.teacher_id` (where trigger_session_id = log.id)
4. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï state ‡πÉ‡∏ô UI ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏´‡∏•‡∏±‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à

### RLS ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° (Migration)

Director ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå UPDATE ‡∏ö‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ:
- `teaching_logs` ‚Äî Director ‡∏°‡∏µ SELECT/INSERT/DELETE ‡πÅ‡∏ï‡πà **‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ UPDATE** policy
- `diagnostic_events` ‚Äî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ UPDATE policy
- `remedial_tracking` ‚Äî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ UPDATE policy
- `pivot_events` ‚Äî ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ UPDATE policy

```sql
CREATE POLICY "Directors can update all logs"
  ON teaching_logs FOR UPDATE
  USING (has_role(auth.uid(), 'director'::app_role));

CREATE POLICY "Directors can update all diagnostic events"
  ON diagnostic_events FOR UPDATE
  USING (has_role(auth.uid(), 'director'::app_role));

CREATE POLICY "Directors can update all remedial tracking"
  ON remedial_tracking FOR UPDATE
  USING (has_role(auth.uid(), 'director'::app_role));

CREATE POLICY "Directors can update all pivot events"
  ON pivot_events FOR UPDATE
  USING (has_role(auth.uid(), 'director'::app_role));
```

### UI Flow

```text
Director ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤ History
  ‚Üí ‡πÄ‡∏´‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏° üë§ ‡∏Ç‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö (‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß)
  ‚Üí ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° ‚Üí Dialog "‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏™‡∏≠‡∏ô"
  ‚Üí Dropdown ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π
  ‚Üí ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å "‡∏Ñ‡∏£‡∏π‡∏ß‡∏£‡∏Å‡∏≤‡∏ô‡∏ï‡πå" ‚Üí ‡∏Å‡∏î‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
  ‚Üí teacher_id + teacher_name ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
  ‚Üí Dashboard ‡πÅ‡∏™‡∏î‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡∏ß‡∏£‡∏Å‡∏≤‡∏ô‡∏ï‡πå‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
```

### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ä‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏π‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏•‡∏ö + re-import
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î (‡∏à‡∏≤‡∏Å‡πÄ‡∏ü‡∏™ 5)

